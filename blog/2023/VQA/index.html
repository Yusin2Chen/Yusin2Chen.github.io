<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>A Preliminary Study of Visual Prompt-Based Open-Vocabulary RSI Segmentation and Change Detection in VLMs | Yusin's Blog</title> <meta name="author" content="Yusin Chen"> <meta name="description" content="how to use LLM for RS VQA tasks"> <meta name="keywords" content="remote sensing, robotics"> <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.21.4/dist/bootstrap-table.min.css"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%9B%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://yusin2chen.github.io/blog/2023/VQA/"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/native.css" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js?96d6b3e1c3604aca8b6134c7afdd5db6"></script> <script src="/assets/js/dark_mode.js?9b17307bb950ffa2e34be0227f53558f"></script> </head> <body class="fixed-top-nav sticky-bottom-footer"> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/">Yusin's Blog</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">Me</a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">blog<span class="sr-only">(current)</span></a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">publications</a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">projects</a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">repositories</a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">cv</a> </li> <li class="nav-item "> <a class="nav-link" href="/teaching/">teaching</a> </li> <li class="nav-item dropdown "> <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">submenus</a> <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown"> <a class="dropdown-item" href="/publications/">publications</a> <div class="dropdown-divider"></div> <a class="dropdown-item" href="/projects/">projects</a> </div> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5"> <div class="post"> <header class="post-header"> <h1 class="post-title">A Preliminary Study of Visual Prompt-Based Open-Vocabulary RSI Segmentation and Change Detection in VLMs</h1> <p class="post-meta">August 15, 2023</p> <p class="post-tags"> <a href="/blog/2023"> <i class="fas fa-calendar fa-sm"></i> 2023 </a>   ·   <a href="/blog/tag/formatting"> <i class="fas fa-hashtag fa-sm"></i> formatting</a>   <a href="/blog/tag/images"> <i class="fas fa-hashtag fa-sm"></i> images</a>     ·   <a href="/blog/category/sample-posts"> <i class="fas fa-tag fa-sm"></i> sample-posts</a>   </p> </header> <article class="post-content"> <div id="markdown-content"> <h1 id="a-preliminary-study-of-visual-prompt-based-open-vocabulary-rsi-segmentation-and-change-detection-in-vlms">A Preliminary Study of Visual Prompt-Based Open-Vocabulary RSI Segmentation and Change Detection in VLMs</h1> <h2 id="abstract">abstract</h2> <p>Large visual-language models (VLMs) have demonstrated robust capabilities in zero-shot classification and information retrieval in remote sensing (RS) images. Nevertheless, their capability is presently constrained to pixel-dense tasks like semantic segmentation and pixel-wise change detection, which have to be done in a particular context in various applications. To address this limitation, this study investigates the utilization of visual prompts combined with textual inputs to tackle open-vocabulary semantic segmentation and change detection tasks on RS images. Specifically, the red boundary of each object obtained from the Segment Anything Model is employed as the visual prompt and to guide the VLM’s focus towards the target of interest while preserving contextual information from the surroundings. Our experimental results demonstrate the potential of the proposed approach, showcasing impressive zero-shot performance and robust reasoning abilities in the realm of RS image open-vocabulary segmentation and change detection tasks.</p> <h2 id="introduction">Introduction</h2> <p>Remote sensing (RS) images encompassing diverse modalities and resolutions contain a wealth of information on land cover and land use, including high-level information about the relationships between different objects. However, the existing techniques for extracting this information are typically tailored to specific tasks and trained on a fixed set of object classes, thus limiting the flexibility in accessing information from RS data. Consequently, the remote sensing community has become increasingly intrigued by the zero-shot capability offered by visual-language models (VLMs \cite{wen2023vision}.). Recently, Chen et al. introduced a conditional Unet model, which utilizes a pre-trained CLIP model and OpenStreetMap (OSM) data to predict segmentation masks based on text descriptions. Although this text-conditioned model allows for the segmentation of interest objects based on textual prompts, its application is restricted to a few types of object annotations from OpenStreetMap and fails to perform detailed inquiries from the images. Seeking interactive dialogue ability, Lobry et al.\cite{lobry2020rsvqa} developed the first visual question answering (VQA) dataset, involving queries about selected areas from OSM integrated with Sentinel-2 images. Moreover, Yuan et al. \cite{yuan2022change} employed a VQA system for change detection on multitemporal aerial images by generating question-answer pairs using an automatic method. To further advance the capabilities of RS vision-language models, Zhan et al. \cite{zhan2022rsvg} curated the RS images-text dataset (RSVG) to tackle the visual grounding task on RS data, which comprises a substantial number of language expressions paired with RS images and object categories. However, it was discovered that vision-language models trained on general VQA and captioning tasks exhibit limited visual reasoning abilities and lack the appropriate visual prompt for dense-pixel downstream tasks. To address these limitations, our proposal involves leveraging segmentation results from the Segment Anything Model as a visual prompt, combined with text prompts, to extract useful information, such as object category and change status, from large VLMs in a zero-shot manner. Notably, we demonstrate that using a red boundary as the visual prompt guides the VLM to analyze or talk about the interest object more effectively than only cropping, as it preserves contextual information. We showcase the potential of zero-shot performance in RS image open-vocabulary segmentation and change detection. Moreover, to overcome challenges in identifying small objects of different scales with context and information queries.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/flowchart-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/flowchart-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/flowchart-1400.webp"></source> <img src="/assets/img/flowchart.jpg" class="img-fluid rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> Fig. 1 Overview of the visual prompt guided open vocabulary remote sensing image semantic segmentation and change detection. (a) We use the Segment Anything Model to get the boundary of each object in the image as our visual prompt. (b) The object-centric image crop with a red boundary around the object is inputted to the VLM with a text prompt for extracting useful information. (c) The text prompt for semantic information query, customized classification and object-based change detection. </div> <h2 id="methodology">Methodology</h2> <h3 id="segment-anything-model">Segment Anything Model</h3> <p>The Segment Anything Model (SAM) is a novel image segmentation tool that was trained using the largest available segmentation dataset. This model can handle both interactive and automatic segmentation tasks. A noteworthy feature of SAM is its promptable interface, affording versatility in its application, as it can be tailored to various segmentation tasks through the appropriate engineering of prompts, such as clicks, boxes, or text. The model’s training is based on an extensive and high-quality dataset comprising over 1 billion masks, meticulously assembled as part of the project. This extensive training empowers the model to demonstrate robust generalization capabilities, enabling it to effectively handle new object types and image scenarios beyond its original training data. Consequently, this capacity to generalize alleviates the need for practitioners to amass their own segmentation data and perform fine-tuning for specific use cases. The SAM architecture is composed of three core components: an image encoder, a flexible prompt encoder, and a fast mask decoder. The image encoder leverages a Vision Transformer (ViT) backbone, capable of processing high-resolution 1024 × 1024 images and generating an image embedding of spatial size 64 × 64. On the other hand, the prompt encoder accepts sparse prompts, encompassing points, boxes, and text, as well as dense prompts, like masks. It skillfully translates these prompts into c-dimensional tokens. Lastly, the lightweight mask decoder seamlessly integrates the image and prompt embeddings, efficiently predicting segmentation masks in real-time, thus enabling SAM to adapt gracefully to diverse prompts while incurring minimal computational overhead.</p> <h3 id="vison-language-models">Vison-Language Models</h3> <p>Large language models (LLMs) have demonstrated remarkable reasoning capabilities in diverse tasks, including chatbot interactions, mathematical calculations, and code generation. Nonetheless, a significant limitation of these models lies in their inability to effectively infer from real-world visual inputs. Generative vision language models, on the other hand, capitalize on pre-trained large language models’ potential to comprehend both images and text, thereby showcasing their prowess in visual reasoning tasks. These generative models excel in tasks like visual question answering, image captioning, optical character recognition, and object detection. For instance, FLAMINGO and BLIP [25] are notable examples of generative VLMs, excelling in captioning and visual question-answering tasks. However, they fall short when confronted with pixel-level computer vision tasks. Training a large multimodal language model (VLM) end-to-end to bridge the gap between LLMs and images can be a computationally expensive endeavor. To overcome this challenge, the prevalent approach for VLMs involves introducing a learnable interface, utilizing frozen pre-trained LLM models between the pre-trained visual encoder and LLM. By employing a set of learned query tokens, these models can extract information through a query-based mechanism, with the vision encoder parameters optimized via backpropagation through a frozen LLM (such as Flamingo, BLIP, LLaVA). In the scope of this study, we investigate the PaLM-E and LLaVA as the Vision-language Model backbone. These models incorporate visual inputs into the same latent embedding as language tokens and process them using self-attention layers within a Transformer-based LLM, similar to how text inputs are treated. The inputs to PaLM-E comprise both textual and (multiple) visual observations. Consequently, we can perform image segmentation on a single visual input or leverage multiple visual inputs for change detection tasks in the context of remote sensing images. An illustrative example of such usage is a question posed as follows: “What events occurred between $<img1>$ and $<img2>$?", where $<img_i>$ represents the image acquired at time $i$.</img_i></img2></img1></p> <h3 id="visual-prompt">Visual Prompt</h3> <p>In the context of prompting VLMs, a prevalent technique involves incorporating a set of learnable tokens into either the text input or the visual inputs. This approach effectively guides a frozen VLM to perform zero-shot inference on downstream tasks. Commonly employed visual prompts include pixel space augmentation techniques, such as image padding, patch modification, or image inpainting. Another notable strategy known as “Colorful Prompt Tuning” entails highlighting color regions within an image and using a captioning model to predict which object in the image a given expression refers to, based on its color. For instance, Shtedritski et al. \cite{shtedritski2023does} utilized a simple red circle drawn around an object in the image to serve as a visual prompt. In line with this concept, our method involves annotating a red enclosed boundary around the designated object, demonstrating that our approach surpasses the effectiveness and flexibility of a mere circular or rectangular bounding box. This red enclosed boundary acts as a powerful and versatile visual prompt, facilitating enhanced interactions with the VLM and enabling more accurate and context-aware zero-shot inferences.</p> <h2 id="experimental-results">Experimental Results</h2> <h3 id="evaluation-setting">Evaluation Setting</h3> <p>In our investigation of open-vocabulary semantic segmentation and change detection, we utilize data sourced from OSM for the purpose of constructing our evaluation dataset. OSM is an openly accessible repository housing geolocalized information that is contributed by volunteers. Leveraging this data, we are able to automatically extract the relevant information, which subsequently aids in generating text descriptions and semantic segmentation maps. The dataset construction process involves several steps. Firstly, we identify the objects of interest and proceed to filter recognizable objects from the land cover and land use layer available in OSM. Examples of such objects include “silos,” “apartments,” “roads,” and others. Subsequently, the vector annotations of these selected objects are rasterized into tiles. By querying all objects that fall within each tile, we obtain a comprehensive semantic segmentation map encompassing the entirety of relevant objects. Furthermore, we undertake a careful examination of changes in various objects by considering the bi-temporal images and the change labels provided by OSM. For semantic segmentation, we consider the semantic segment anything model as a comparison \cite{chen2023semantic} in the future, which is based on the Segment Anything Model and gets the rich vocabulary semantic information from CLIPSeg, BLIP and CLIP. For change detection, we consider the CDVQA as a potential comparison, which only provides the text description of changes.</p> <h3 id="results">Results</h3> <p>We first evaluate the results of semantic segmentation considering various object sizes. In Fig. \ref{fig2}, we present RGB images alongside segmentations obtained from SAM and semantic information derived from the VLM. Notably, to ensure contextual relevance and informative details, we eliminated excessively small and large objects based on image size. This step is essential as object information cannot be reliably inferred without adequate context or sufficient details. Regarding semantic information, square-shaped objects exhibit superior results compared to slim and elongated objects. The segmentation of slim objects includes more unrelated context, which confuses the VLM’s understanding. Furthermore, the VLM struggles with small objects that lack detailed information within the given image resolution. Additionally, the VLM may even yield unrelated information when encountering objects with shadows. For change detection, our approach involves obtaining segmentations of bi-temporal images using SAM. Subsequently, we remove all overlapped objects, indicating no changes have occurred. The remaining objects, accompanied by visual prompts, are then fed into the VLM to identify their object types. This serves as context for text prompts to query whether changes happened or not. It is worth noting that the changing status for different objects varies; for example, a parking lot may remain unchanged with or without cars, but changes can still occur in other aspects. In the realm of change detection, the selection of an appropriate text prompt is critical. Generally, we observed that comparing segmentations from bi-temporal images effectively detects the most changed objects. Any remaining false alarms can be mitigated by querying the VLM, particularly in complex scenes. This process assists in refining the accuracy of change detection results.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/segmentation-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/segmentation-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/segmentation-1400.webp"></source> <img src="/assets/img/segmentation.jpg" class="img-fluid rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> Fig. 2 Examples of semantic segmentation results obtained by SAM and Google Bard, organized in three scenes. Col. 1: RGB images, Col. 2: segmentations from SAM, Col. 3: semantic information from Google Bard. </div> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/change%20detection-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/change%20detection-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/change%20detection-1400.webp"></source> <img src="/assets/img/change%20detection.jpg" class="img-fluid rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> Fig. 3 Examples of change detection results obtained by SAM and Google Bard. Col. 1: pre-event images, Col. 2: post-event images, Col. 3: objects with change information. </div> <h2 id="conclusion">Conclusion</h2> <p>In this study, we have shown that the visual prompt from SAM can extract useful semantic information and change statu information from VLMs such as Google Bard and LLaVA in a zero-shot manner, achieving the zero-shot open-vocabulary remote sensing image segmentation and change detection performance. Our comprehensive analysis highlights that the visual prompt and reasoning capabilities of these large multimodal language models can effectively extract pertinent information from complex geospatial scenes. However, it is evident that models trained solely on natural images exhibit certain limitations when applied to remote sensing images. To further enhance the performance of our approach, it is imperative to conduct additional fine-tuning of the SAM and VLMs on remote sensing images. Preliminary findings indicate the need for this fine-tuning process. In our future research endeavors, we envision incorporating diverse sensor data, such as synthetic-aperture radar (SAR), multispectral, and hyperspectral images, in order to enhance the inference performance of our approach and better accommodate the unique characteristics of remote sensing data.</p> </div> </article> <br> <hr> <br> <ul class="list-disc pl-8"></ul> <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2> <p class="mb-2">Here are some more articles you might like to read next:</p> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2022/displaying-external-posts-on-your-al-folio-blog/">Displaying External Posts on Your al-folio Blog</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2021/diagrams/">a post with diagrams</a> </li> </div> </div> <footer class="sticky-bottom mt-5"> <div class="container"> © Copyright 2023 Yusin Chen. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha256-fgLAgv7fyCGopR/gBNq2iW3ZKIdqIcyshnUULC4vex8=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js"></script> <script defer src="https://unpkg.com/bootstrap-table@1.21.4/dist/bootstrap-table.min.js"></script> <script src="/assets/js/no_defer.js?d633890033921b33e0ceb13d22340a9c"></script> <script defer src="/assets/js/common.js?acdb9690d7641b2f8d40529018c71a01"></script> <script defer src="/assets/js/copy_code.js?c9d9dd48933de3831b3ee5ec9c209cac" type="text/javascript"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>